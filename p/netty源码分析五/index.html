<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='åœ¨å‰é¢çš„å››ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å¯¹ NIO çš„æ¦‚å¿µå·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚å½“ç„¶ï¼Œèƒ–å‹ä¹Ÿå¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå·²ç»è¢«ä¸€å †æ¦‚å¿µçƒ¦æ­»äº†ã€‚
é‚£ä¹ˆæœ¬æ–‡ï¼Œæˆ‘ä»¬æ’¸èµ·è¢–å­ï¼Œå°±æ˜¯å¹²ä»£ç ï¼Œä¸çæ¯”æ¯”äº†ã€‚
å½“ç„¶ï¼Œä¸‹é¢æ›´å¤šçš„æ˜¯æä¾›ä¸€ä¸ª NIO ç¤ºä¾‹ã€‚çœŸæ­£ç”Ÿäº§çº§çš„ NIO ä»£ç ï¼Œå»ºè®®èƒ–å‹é‡æ–°å†™ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Netty ã€‚
ä»£ç ä»“åº“åœ¨Â example/yunai/nioÂ ç›®å½•ä¸‹ã€‚ä¸€å…± 3 ä¸ªç±»ï¼š
NioServer ï¼šNIO æœåŠ¡ç«¯ã€‚
NioClient ï¼šNIO å®¢æˆ·ç«¯ã€‚
CodecUtil ï¼šæ¶ˆæ¯ç¼–è§£ç å·¥å…·ç±»ã€‚
2. æœåŠ¡ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 1: public class NioServer { 2: 3: private ServerSocketChannel serverSocketChannel; 4: private Selector selector; 5: 6: public NioServer() throws IOException { 7: // æ‰“å¼€ Server Socket Channel 8: serverSocketChannel = ServerSocketChannel.'>
<title>nettyæºç åˆ†æäº”</title>

<link rel='canonical' href='https://tauzi.github.io/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%BA%94/'>

<link rel="stylesheet" href="/myblog/scss/style.min.50c1fc6533b62d77f594233c8f3413de02946f2ffe11e85728071f2bc3aae8e2.css"><meta property='og:title' content='nettyæºç åˆ†æäº”'>
<meta property='og:description' content='åœ¨å‰é¢çš„å››ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å¯¹ NIO çš„æ¦‚å¿µå·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚å½“ç„¶ï¼Œèƒ–å‹ä¹Ÿå¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå·²ç»è¢«ä¸€å †æ¦‚å¿µçƒ¦æ­»äº†ã€‚
é‚£ä¹ˆæœ¬æ–‡ï¼Œæˆ‘ä»¬æ’¸èµ·è¢–å­ï¼Œå°±æ˜¯å¹²ä»£ç ï¼Œä¸çæ¯”æ¯”äº†ã€‚
å½“ç„¶ï¼Œä¸‹é¢æ›´å¤šçš„æ˜¯æä¾›ä¸€ä¸ª NIO ç¤ºä¾‹ã€‚çœŸæ­£ç”Ÿäº§çº§çš„ NIO ä»£ç ï¼Œå»ºè®®èƒ–å‹é‡æ–°å†™ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Netty ã€‚
ä»£ç ä»“åº“åœ¨Â example/yunai/nioÂ ç›®å½•ä¸‹ã€‚ä¸€å…± 3 ä¸ªç±»ï¼š
NioServer ï¼šNIO æœåŠ¡ç«¯ã€‚
NioClient ï¼šNIO å®¢æˆ·ç«¯ã€‚
CodecUtil ï¼šæ¶ˆæ¯ç¼–è§£ç å·¥å…·ç±»ã€‚
2. æœåŠ¡ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 1: public class NioServer { 2: 3: private ServerSocketChannel serverSocketChannel; 4: private Selector selector; 5: 6: public NioServer() throws IOException { 7: // æ‰“å¼€ Server Socket Channel 8: serverSocketChannel = ServerSocketChannel.'>
<meta property='og:url' content='https://tauzi.github.io/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%BA%94/'>
<meta property='og:site_name' content='TauZZ&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2023-05-04T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-05-04T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="nettyæºç åˆ†æäº”">
<meta name="twitter:description" content="åœ¨å‰é¢çš„å››ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å¯¹ NIO çš„æ¦‚å¿µå·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚å½“ç„¶ï¼Œèƒ–å‹ä¹Ÿå¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå·²ç»è¢«ä¸€å †æ¦‚å¿µçƒ¦æ­»äº†ã€‚
é‚£ä¹ˆæœ¬æ–‡ï¼Œæˆ‘ä»¬æ’¸èµ·è¢–å­ï¼Œå°±æ˜¯å¹²ä»£ç ï¼Œä¸çæ¯”æ¯”äº†ã€‚
å½“ç„¶ï¼Œä¸‹é¢æ›´å¤šçš„æ˜¯æä¾›ä¸€ä¸ª NIO ç¤ºä¾‹ã€‚çœŸæ­£ç”Ÿäº§çº§çš„ NIO ä»£ç ï¼Œå»ºè®®èƒ–å‹é‡æ–°å†™ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Netty ã€‚
ä»£ç ä»“åº“åœ¨Â example/yunai/nioÂ ç›®å½•ä¸‹ã€‚ä¸€å…± 3 ä¸ªç±»ï¼š
NioServer ï¼šNIO æœåŠ¡ç«¯ã€‚
NioClient ï¼šNIO å®¢æˆ·ç«¯ã€‚
CodecUtil ï¼šæ¶ˆæ¯ç¼–è§£ç å·¥å…·ç±»ã€‚
2. æœåŠ¡ç«¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 1: public class NioServer { 2: 3: private ServerSocketChannel serverSocketChannel; 4: private Selector selector; 5: 6: public NioServer() throws IOException { 7: // æ‰“å¼€ Server Socket Channel 8: serverSocketChannel = ServerSocketChannel.">
    <link rel="shortcut icon" href="img/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "light");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/myblog/">
                
                    
                    
                    
                        
                        <img src="/myblog/img/avatar_hu41e9bf84b16d248cd89556079ae4f725_243458_300x0_resize_box_3.png" width="300"
                            height="442" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/myblog">TauZZ&#39;s Blog</a></h1>
            <h2 class="site-description">åŠ æ²¹åŠªåŠ›.âœï¸</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://img.picgo.net/2023/05/09/3b2ebde1c8640d69530516428a740b82ea5623263a52eda.jpeg'
                        target="_blank"
                        title="Dreamq0p"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1683196971239" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2753" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M1024 624.6c0-149.9-142.3-271.8-317.2-271.8s-317.2 122-317.2 271.8c0 149.9 142.3 271.8 317.2 271.8 30.4 0 60.5-3.7 89.4-10.9 7.9 1.1 30.2 13 43.7 20.2 29.4 15.6 49.6 25.8 65.9 25.8 5.2 0 9.9-1 14.4-3.2 24.9-12.1 15-43.1 5.5-73.1-2.5-8-6.5-20.4-7.8-27.7C985.5 776 1024 702.4 1024 624.6z m-137.5 173c-19.4 14.1-11.1 40.2-1.5 70.5 1.3 4.2 3 9.5 4.5 14.7-9.7-4.4-21.1-10.5-29.4-14.9-29.3-15.6-48.5-25.3-64.3-25.3-3 0-5.8 0.3-8.6 1.1-25.9 6.6-52.9 10-80.3 10-151.3 0-274.3-102.7-274.3-229s123.1-229 274.3-229 274.3 102.7 274.3 229c-0.1 66.3-34.6 129.3-94.7 172.9z" p-id="2754" fill="#bfbfbf"></path><path d="M379.1 621.5c0-150.7 146.6-273.7 326.7-274.1 6.9 0 13.4-3.4 17.4-9 4-5.7 5-12.9 2.8-19.4-22.4-64.5-69.6-122.4-132.7-163-64.6-41.5-141.5-63.5-222.6-63.5C166.3 92.5 0 234.8 0 409.7c0 91.4 45.7 177.7 125.5 238-1.2 8.5-6.4 25-9.7 35.5-11.2 35.4-21.8 68.9 4.5 81.7 4.8 2.3 9.8 3.4 15.4 3.4 18.3 0 41.7-11.8 76-30 16.8-8.9 44.7-23.7 53.7-24.3 34.1 8.6 69.5 13 105.4 13h1.3c6.9 0 13.5-3.4 17.5-9 4-5.7 5-12.9 2.8-19.5-8.8-25.2-13.3-51-13.3-77z m-42.8 0c0 20.7 2.4 41.3 7 61.5-23.2-1.6-46.1-5.3-68.3-11-19.4-5-44.3 7.5-83.4 28.3-12.1 6.4-29.7 15.8-42.5 21 2.1-8.3 5.3-18.2 7.5-25.3 10.9-34.4 20.3-64-0.4-79-72-52.2-113.3-127.8-113.3-207.3 0-151.3 147.1-274.3 327.9-274.3 133.2 0 253.5 68.8 303.4 170.4-189 14.1-337.9 150.5-337.9 315.7z" p-id="2755" fill="#bfbfbf"></path><path d="M249.9 305.3m-42.9 0a42.9 42.9 0 1 0 85.8 0 42.9 42.9 0 1 0-85.8 0Z" p-id="2756" fill="#bfbfbf"></path><path d="M493.9 305.3m-42.9 0a42.9 42.9 0 1 0 85.8 0 42.9 42.9 0 1 0-85.8 0Z" p-id="2757" fill="#bfbfbf"></path><path d="M614.9 548.2m-34.3 0a34.3 34.3 0 1 0 68.6 0 34.3 34.3 0 1 0-68.6 0Z" p-id="2758" fill="#bfbfbf"></path><path d="M806.7 548.2m-34.3 0a34.3 34.3 0 1 0 68.6 0 34.3 34.3 0 1 0-68.6 0Z" p-id="2759" fill="#bfbfbf"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/Tauzi'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/myblog/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/myblog/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/myblog/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/myblog/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/myblog/%E5%8F%8B%E9%93%BE/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹é“¾</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#httpsvipiocodercnnettynio-5-demo2-1-e69e84e980a0e696b9e6b395-21-æ„é€ æ–¹æ³•21-æ„é€ æ–¹æ³•"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-1-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95" title="2.1 æ„é€ æ–¹æ³•"></a>2.1 æ„é€ æ–¹æ³•</a></li>
    <li><a href="#httpsvipiocodercnnettynio-5-demo2-2-handlekeys-22-handlekeys22-handlekeys"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-handleKeys" title="2.2 handleKeys"></a>2.2 handleKeys</a>
      <ol>
        <li><a href="#httpsvipiocodercnnettynio-5-demo2-2-1-handlekey-221-handlekey221-handlekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-1-handleKey" title="2.2.1 handleKey"></a>2.2.1 handleKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo2-2-2-handleacceptablekey-222-handleacceptablekey222-handleacceptablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-2-handleAcceptableKey" title="2.2.2 handleAcceptableKey"></a>2.2.2 handleAcceptableKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo2-2-3-handlereadablekey-223-handlereadablekey223-handlereadablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-3-handleReadableKey" title="2.2.3 handleReadableKey"></a>2.2.3 handleReadableKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo2-2-4-handlewritablekey-224-handlewritablekey224-handlewritablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-4-handleWritableKey" title="2.2.4 handleWritableKey"></a>2.2.4 handleWritableKey</a></li>
      </ol>
    </li>
    <li><a href="#httpsvipiocodercnnettynio-5-demo2-3-main-23-main23-main"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-3-main" title="2.3 main"></a>2.3 main</a></li>
  </ol>

  <ol>
    <li><a href="#httpsvipiocodercnnettynio-5-demo3-1-e69e84e980a0e696b9e6b395-31-æ„é€ æ–¹æ³•31-æ„é€ æ–¹æ³•"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-1-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95" title="3.1 æ„é€ æ–¹æ³•"></a>3.1 æ„é€ æ–¹æ³•</a></li>
    <li><a href="#httpsvipiocodercnnettynio-5-demo3-2-handlekeys-32-handlekeys32-handlekeys"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-2-handleKeys" title="3.2 handleKeys"></a>3.2 handleKeys</a>
      <ol>
        <li><a href="#httpsvipiocodercnnettynio-5-demo3-2-1-handlekey-321-handlekey321-handlekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-2-1-handleKey" title="3.2.1 handleKey"></a>3.2.1 handleKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo3-3-2-handleconnectablekey-332-handleconnectablekey332-handleconnectablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-2-handleConnectableKey" title="3.3.2 handleConnectableKey"></a>3.3.2 handleConnectableKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo3-3-3-handlereadablekey-333-handlereadablekey333-handlereadablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-3-handleReadableKey" title="3.3.3 handleReadableKey"></a>3.3.3 handleReadableKey</a></li>
        <li><a href="#httpsvipiocodercnnettynio-5-demo3-3-4-handlewritablekey-334-handlewritablekey334-handlewritablekey"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-4-handleWritableKey" title="3.3.4 handleWritableKey"></a>3.3.4 handleWritableKey</a></li>
      </ol>
    </li>
    <li><a href="#httpsvipiocodercnnettynio-5-demo3-3-send-33-send33-send"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-send" title="3.3 send"></a>3.3 send</a></li>
    <li><a href="#httpsvipiocodercnnettynio-5-demo3-4-main-34-main34-main"><a href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-4-main" title="3.4 main"></a>3.4 main</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/myblog/categories/netty/" >
                Netty
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%BA%94/">nettyæºç åˆ†æäº”</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 04, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 11 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>åœ¨å‰é¢çš„å››ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å¯¹ NIO çš„æ¦‚å¿µå·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚å½“ç„¶ï¼Œèƒ–å‹ä¹Ÿå¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œå·²ç»è¢«ä¸€å †æ¦‚å¿µçƒ¦æ­»äº†ã€‚</p>
<p>é‚£ä¹ˆæœ¬æ–‡ï¼Œæˆ‘ä»¬æ’¸èµ·è¢–å­ï¼Œå°±æ˜¯å¹²ä»£ç ï¼Œä¸çæ¯”æ¯”äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¸‹é¢æ›´å¤šçš„æ˜¯æä¾›ä¸€ä¸ª NIO ç¤ºä¾‹ã€‚çœŸæ­£ç”Ÿäº§çº§çš„ NIO ä»£ç ï¼Œå»ºè®®èƒ–å‹é‡æ–°å†™ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Netty ã€‚</p>
<p>ä»£ç ä»“åº“åœ¨Â <a class="link" href="https://github.com/YunaiV/netty/tree/f7016330f1483021ef1c38e0923e1c8b7cef0d10/example/src/main/java/io/netty/example/yunai/nio"  target="_blank" rel="noopener"
    >example/yunai/nio</a>Â ç›®å½•ä¸‹ã€‚ä¸€å…± 3 ä¸ªç±»ï¼š</p>
<ul>
<li>
<p>NioServer ï¼šNIO æœåŠ¡ç«¯ã€‚</p>
</li>
<li>
<p>NioClient ï¼šNIO å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p>CodecUtil ï¼šæ¶ˆæ¯ç¼–è§£ç å·¥å…·ç±»ã€‚</p>
</li>
</ul>
<h1 id="httpsvipiocodercnnettynio-5-demo2-e69c8de58aa1e7abaf-2-æœåŠ¡ç«¯2-æœåŠ¡ç«¯"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-%E6%9C%8D%E5%8A%A1%E7%AB%AF"  title="2. æœåŠ¡ç«¯"
     target="_blank" rel="noopener"
    ></a>2. æœåŠ¡ç«¯</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 1: public class NioServer {  
</span></span><span class="line"><span class="cl"> 2:   
</span></span><span class="line"><span class="cl"> 3: Â  Â  private ServerSocketChannel serverSocketChannel;  
</span></span><span class="line"><span class="cl"> 4: Â  Â  private Selector selector;  
</span></span><span class="line"><span class="cl"> 5:   
</span></span><span class="line"><span class="cl"> 6: Â  Â  public NioServer() throws IOException {  
</span></span><span class="line"><span class="cl"> 7: Â  Â  Â  Â  // æ‰“å¼€ Server Socket Channel  
</span></span><span class="line"><span class="cl"> 8: Â  Â  Â  Â  serverSocketChannel = ServerSocketChannel.open();  
</span></span><span class="line"><span class="cl"> 9: Â  Â  Â  Â  // é…ç½®ä¸ºéé˜»å¡  
</span></span><span class="line"><span class="cl"> 10: Â  Â  Â  Â  serverSocketChannel.configureBlocking(false);  
</span></span><span class="line"><span class="cl"> 11: Â  Â  Â  Â  // ç»‘å®š Server port  
</span></span><span class="line"><span class="cl"> 12: Â  Â  Â  Â  serverSocketChannel.socket().bind(new InetSocketAddress(8080));  
</span></span><span class="line"><span class="cl"> 13: Â  Â  Â  Â  // åˆ›å»º Selector  
</span></span><span class="line"><span class="cl"> 14: Â  Â  Â  Â  selector = Selector.open();  
</span></span><span class="line"><span class="cl"> 15: Â  Â  Â  Â  // æ³¨å†Œ Server Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl"> 16: Â  Â  Â  Â  serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);  
</span></span><span class="line"><span class="cl"> 17: Â  Â  Â  Â  System.out.println(&#34;Server å¯åŠ¨å®Œæˆ&#34;);  
</span></span><span class="line"><span class="cl"> 18:   
</span></span><span class="line"><span class="cl"> 19: Â  Â  Â  Â  handleKeys();  
</span></span><span class="line"><span class="cl"> 20: Â  Â  }  
</span></span><span class="line"><span class="cl"> 21:   
</span></span><span class="line"><span class="cl"> 22: Â  Â  private void handleKeys() throws IOException {  
</span></span><span class="line"><span class="cl"> 23: Â  Â  Â  Â  while (true) {  
</span></span><span class="line"><span class="cl"> 24: Â  Â  Â  Â  Â  Â  // é€šè¿‡ Selector é€‰æ‹© Channel  
</span></span><span class="line"><span class="cl"> 25: Â  Â  Â  Â  Â  Â  int selectNums = selector.select(30 \* 1000L);  
</span></span><span class="line"><span class="cl"> 26: Â  Â  Â  Â  Â  Â  if (selectNums == 0) {  
</span></span><span class="line"><span class="cl"> 27: Â  Â  Â  Â  Â  Â  Â  Â  continue;  
</span></span><span class="line"><span class="cl"> 28: Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 29: Â  Â  Â  Â  Â  Â  System.out.println(&#34;é€‰æ‹© Channel æ•°é‡ï¼š&#34; \+ selectNums);  
</span></span><span class="line"><span class="cl"> 30:   
</span></span><span class="line"><span class="cl"> 31: Â  Â  Â  Â  Â  Â  // éå†å¯é€‰æ‹©çš„ Channel çš„ SelectionKey é›†åˆ  
</span></span><span class="line"><span class="cl"> 32: Â  Â  Â  Â  Â  Â  Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();  
</span></span><span class="line"><span class="cl"> 33: Â  Â  Â  Â  Â  Â  while (iterator.hasNext()) {  
</span></span><span class="line"><span class="cl"> 34: Â  Â  Â  Â  Â  Â  Â  Â  SelectionKey key = iterator.next();  
</span></span><span class="line"><span class="cl"> 35: Â  Â  Â  Â  Â  Â  Â  Â  iterator.remove(); // ç§»é™¤ä¸‹é¢è¦å¤„ç†çš„ SelectionKey  
</span></span><span class="line"><span class="cl"> 36: Â  Â  Â  Â  Â  Â  Â  Â  if (!key.isValid()) { // å¿½ç•¥æ— æ•ˆçš„ SelectionKey  
</span></span><span class="line"><span class="cl"> 37: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;  
</span></span><span class="line"><span class="cl"> 38: Â  Â  Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 39:   
</span></span><span class="line"><span class="cl"> 40: Â  Â  Â  Â  Â  Â  Â  Â  handleKey(key);  
</span></span><span class="line"><span class="cl"> 41: Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 42: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 43: Â  Â  }  
</span></span><span class="line"><span class="cl"> 44:   
</span></span><span class="line"><span class="cl"> 45: Â  Â  private void handleKey(SelectionKey key) throws IOException {  
</span></span><span class="line"><span class="cl"> 46: Â  Â  Â  Â  // æ¥å—è¿æ¥å°±ç»ª  
</span></span><span class="line"><span class="cl"> 47: Â  Â  Â  Â  if (key.isAcceptable()) {  
</span></span><span class="line"><span class="cl"> 48: Â  Â  Â  Â  Â  Â  handleAcceptableKey(key);  
</span></span><span class="line"><span class="cl"> 49: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 50: Â  Â  Â  Â  // è¯»å°±ç»ª  
</span></span><span class="line"><span class="cl"> 51: Â  Â  Â  Â  if (key.isReadable()) {  
</span></span><span class="line"><span class="cl"> 52: Â  Â  Â  Â  Â  Â  handleReadableKey(key);  
</span></span><span class="line"><span class="cl"> 53: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 54: Â  Â  Â  Â  // å†™å°±ç»ª  
</span></span><span class="line"><span class="cl"> 55: Â  Â  Â  Â  if (key.isWritable()) {  
</span></span><span class="line"><span class="cl"> 56: Â  Â  Â  Â  Â  Â  handleWritableKey(key);  
</span></span><span class="line"><span class="cl"> 57: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 58: Â  Â  }  
</span></span><span class="line"><span class="cl"> 59:   
</span></span><span class="line"><span class="cl"> 60: Â  Â  private void handleAcceptableKey(SelectionKey key) throws IOException {  
</span></span><span class="line"><span class="cl"> 61: Â  Â  Â  Â  // æ¥å— Client Socket Channel  
</span></span><span class="line"><span class="cl"> 62: Â  Â  Â  Â  SocketChannel clientSocketChannel = ((ServerSocketChannel) key.channel()).accept();  
</span></span><span class="line"><span class="cl"> 63: Â  Â  Â  Â  // é…ç½®ä¸ºéé˜»å¡  
</span></span><span class="line"><span class="cl"> 64: Â  Â  Â  Â  clientSocketChannel.configureBlocking(false);  
</span></span><span class="line"><span class="cl"> 65: Â  Â  Â  Â  // log  
</span></span><span class="line"><span class="cl"> 66: Â  Â  Â  Â  System.out.println(&#34;æ¥å—æ–°çš„ Channel&#34;);  
</span></span><span class="line"><span class="cl"> 67: Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl"> 68: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_READ, new ArrayList&lt;String&gt;());  
</span></span><span class="line"><span class="cl"> 69: Â  Â  }  
</span></span><span class="line"><span class="cl"> 70:   
</span></span><span class="line"><span class="cl"> 71: Â  Â  private void handleReadableKey(SelectionKey key) throws IOException {  
</span></span><span class="line"><span class="cl"> 72: Â  Â  Â  Â  // Client Socket Channel  
</span></span><span class="line"><span class="cl"> 73: Â  Â  Â  Â  SocketChannel clientSocketChannel = (SocketChannel) key.channel();  
</span></span><span class="line"><span class="cl"> 74: Â  Â  Â  Â  // è¯»å–æ•°æ®  
</span></span><span class="line"><span class="cl"> 75: Â  Â  Â  Â  ByteBuffer readBuffer = CodecUtil.read(clientSocketChannel);  
</span></span><span class="line"><span class="cl"> 76: Â  Â  Â  Â  // å¤„ç†è¿æ¥å·²ç»æ–­å¼€çš„æƒ…å†µ  
</span></span><span class="line"><span class="cl"> 77: Â  Â  Â  Â  if (readBuffer == null) {  
</span></span><span class="line"><span class="cl"> 78: Â  Â  Â  Â  Â  Â  System.out.println(&#34;æ–­å¼€ Channel&#34;);  
</span></span><span class="line"><span class="cl"> 79: Â  Â  Â  Â  Â  Â  clientSocketChannel.register(selector, 0);  
</span></span><span class="line"><span class="cl"> 80: Â  Â  Â  Â  Â  Â  return;  
</span></span><span class="line"><span class="cl"> 81: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 82: Â  Â  Â  Â  // æ‰“å°æ•°æ®  
</span></span><span class="line"><span class="cl"> 83: Â  Â  Â  Â  if (readBuffer.position() &gt; 0) {  
</span></span><span class="line"><span class="cl"> 84: Â  Â  Â  Â  Â  Â  String content = CodecUtil.newString(readBuffer);  
</span></span><span class="line"><span class="cl"> 85: Â  Â  Â  Â  Â  Â  System.out.println(&#34;è¯»å–æ•°æ®ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl"> 86:   
</span></span><span class="line"><span class="cl"> 87: Â  Â  Â  Â  Â  Â  // æ·»åŠ åˆ°å“åº”é˜Ÿåˆ—  
</span></span><span class="line"><span class="cl"> 88: Â  Â  Â  Â  Â  Â  List&lt;String&gt; responseQueue = (ArrayList&lt;String&gt;) key.attachment();  
</span></span><span class="line"><span class="cl"> 89: Â  Â  Â  Â  Â  Â  responseQueue.add(&#34;å“åº”ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl"> 90: Â  Â  Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl"> 91: Â  Â  Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_WRITE, key.attachment());  
</span></span><span class="line"><span class="cl"> 92: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 93: Â  Â  }  
</span></span><span class="line"><span class="cl"> 94:   
</span></span><span class="line"><span class="cl"> 95: Â  Â  @SuppressWarnings(&#34;Duplicates&#34;)  
</span></span><span class="line"><span class="cl"> 96: Â  Â  private void handleWritableKey(SelectionKey key) throws ClosedChannelException {  
</span></span><span class="line"><span class="cl"> 97: Â  Â  Â  Â  // Client Socket Channel  
</span></span><span class="line"><span class="cl"> 98: Â  Â  Â  Â  SocketChannel clientSocketChannel = (SocketChannel) key.channel();  
</span></span><span class="line"><span class="cl"> 99:   
</span></span><span class="line"><span class="cl">100: Â  Â  Â  Â  // éå†å“åº”é˜Ÿåˆ—  
</span></span><span class="line"><span class="cl">101: Â  Â  Â  Â  List&lt;String&gt; responseQueue = (ArrayList&lt;String&gt;) key.attachment();  
</span></span><span class="line"><span class="cl">102: Â  Â  Â  Â  for (String content : responseQueue) {  
</span></span><span class="line"><span class="cl">103: Â  Â  Â  Â  Â  Â  // æ‰“å°æ•°æ®  
</span></span><span class="line"><span class="cl">104: Â  Â  Â  Â  Â  Â  System.out.println(&#34;å†™å…¥æ•°æ®ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl">105: Â  Â  Â  Â  Â  Â  // è¿”å›  
</span></span><span class="line"><span class="cl">106: Â  Â  Â  Â  Â  Â  CodecUtil.write(clientSocketChannel, content);  
</span></span><span class="line"><span class="cl">107: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl">108: Â  Â  Â  Â  responseQueue.clear();  
</span></span><span class="line"><span class="cl">109:   
</span></span><span class="line"><span class="cl">110: Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl">111: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_READ, responseQueue);  
</span></span><span class="line"><span class="cl">112: Â  Â  }  
</span></span><span class="line"><span class="cl">113:   
</span></span><span class="line"><span class="cl">114: Â  Â  public static void main(String\[\] args) throws IOException {  
</span></span><span class="line"><span class="cl">115: Â  Â  Â  Â  NioServer server = new NioServer();  
</span></span><span class="line"><span class="cl">116: Â  Â  }  
</span></span><span class="line"><span class="cl">117:   
</span></span><span class="line"><span class="cl">118: }  
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´å—ä»£ç æˆ‘ä»¬å¯ä»¥åˆ†æˆ 3 éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>æ„é€ æ–¹æ³•ï¼šåˆå§‹åŒ– NIO æœåŠ¡ç«¯ã€‚</p>
</li>
<li>
<p><code>#handleKeys()</code>Â æ–¹æ³•ï¼šåŸºäº Selector å¤„ç† IO æ“ä½œã€‚</p>
</li>
<li>
<p><code>#main(String[] args)</code>Â æ–¹æ³•ï¼šåˆ›å»º NIO æœåŠ¡ç«¯ã€‚</p>
</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€å°èŠ‚æ¥åˆ†äº«ã€‚</p>
<h2 id="httpsvipiocodercnnettynio-5-demo2-1-e69e84e980a0e696b9e6b395-21-æ„é€ æ–¹æ³•21-æ„é€ æ–¹æ³•"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-1-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"  title="2.1 æ„é€ æ–¹æ³•"
     target="_blank" rel="noopener"
    ></a>2.1 æ„é€ æ–¹æ³•</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 3 è‡³ 20 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p><code>serverSocketChannel</code>Â å±æ€§ï¼ŒæœåŠ¡ç«¯çš„ ServerSocketChannel ï¼Œåœ¨ã€ç¬¬ 7 è‡³ 12 è¡Œã€‘çš„ä»£ç è¿›è¡Œåˆå§‹åŒ–ï¼Œé‡ç‚¹æ˜¯æ­¤å¤„å¯åŠ¨äº†æœåŠ¡ç«¯ï¼Œå¹¶ç›‘å¬æŒ‡å®šç«¯å£( æ­¤å¤„ä¸º 8080 )ã€‚</p>
</li>
<li>
<p><code>selector</code>Â å±æ€§ï¼Œé€‰æ‹©å™¨ï¼Œåœ¨ã€ç¬¬ 14 è‡³ 16 è¡Œã€‘çš„ä»£ç è¿›è¡Œåˆå§‹åŒ–ï¼Œé‡ç‚¹æ˜¯æ­¤å¤„å°†Â <code>serverSocketChannel</code>Â åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_ACCEPT</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚è¿™æ ·å­ï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤„ç†è¯¥ IO äº‹ä»¶ã€‚</p>
</li>
<li>
<p>ç¬¬ 19 è¡Œï¼šè°ƒç”¨Â <code>#handleKeys()</code>Â æ–¹æ³•ï¼ŒåŸºäº Selector å¤„ç† IO äº‹ä»¶ã€‚</p>
</li>
</ul>
<h2 id="httpsvipiocodercnnettynio-5-demo2-2-handlekeys-22-handlekeys22-handlekeys"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-handleKeys"  title="2.2 handleKeys"
     target="_blank" rel="noopener"
    ></a>2.2 handleKeys</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 22 è‡³ 43 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 23 è¡Œï¼šæ­»å¾ªç¯ã€‚æœ¬æ–‡çš„ç¤ºä¾‹ï¼Œä¸è€ƒè™‘æœåŠ¡ç«¯å…³é—­çš„é€»è¾‘ã€‚</p>
</li>
<li>
<p>ç¬¬ 24 è‡³ 29 è¡Œï¼šè°ƒç”¨Â <code>Selector#select(long timeout)</code>Â æ–¹æ³•ï¼Œæ¯ 30 ç§’é˜»å¡ç­‰å¾…æœ‰å°±ç»ªçš„ IO äº‹ä»¶ã€‚æ­¤å¤„çš„ 30 ç§’ä¸ºç¬”è€…éšæ„å†™çš„ï¼Œå®é™…ä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–è¶…æ—¶æ—¶é—´ï¼Œæˆ–è€…Â <code>Selector#select()</code>Â æ–¹æ³•ã€‚å½“ä¸å­˜åœ¨å°±ç»ªçš„ IO äº‹ä»¶ï¼Œç›´æ¥Â <code>continue</code>Â ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡é˜»å¡ç­‰å¾…ã€‚</p>
</li>
<li>
<p>ç¬¬ 32 è¡Œï¼šè°ƒç”¨Â <code>Selector#selectedKeys()</code>Â æ–¹æ³•ï¼Œè·å¾—æœ‰å°±ç»ªçš„ IO äº‹ä»¶( ä¹Ÿå¯ä»¥ç§°ä¸ºâ€œé€‰æ‹©çš„â€ ) Channel å¯¹åº”çš„ SelectionKey é›†åˆã€‚</p>
</li>
<li>
<p>ç¬¬ 33 è¡Œ è‡³ 35 è¡Œï¼šéå†Â <code>iterator</code>Â ï¼Œè¿›è¡Œé€ä¸ª SelectionKey å¤„ç†ã€‚é‡ç‚¹æ³¨æ„ä¸‹ï¼Œå¤„ç†å®Œéœ€è¦è¿›è¡Œç§»é™¤ï¼Œå…·ä½“åŸå› ï¼Œåœ¨Â <a class="link" href="http://svip.iocoder.cn/Netty/nio-4-selector/#10-%E7%AE%80%E5%8D%95-Selector-%E7%A4%BA%E4%BE%8B"  target="_blank" rel="noopener"
    >ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” NIO åŸºç¡€ï¼ˆå››ï¼‰ä¹‹ Selectorã€‹ã€Œ10. ç®€å• Selector ç¤ºä¾‹ã€</a>Â æœ‰è¯¦ç»†è§£æã€‚</p>
</li>
<li>
<p>ç¬¬ 36 è‡³ 38 è¡Œï¼šåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½è¯¥ SelectionKey å·²ç»<strong>å¤±æ•ˆ</strong>ï¼Œç›´æ¥Â <code>continue</code>Â ï¼Œä¸è¿›è¡Œå¤„ç†ã€‚</p>
</li>
<li>
<p>ç¬¬ 40 è¡Œï¼šè°ƒç”¨Â <code>#handleKey()</code>Â æ–¹æ³•ï¼Œé€ä¸ª SelectionKey å¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="httpsvipiocodercnnettynio-5-demo2-2-1-handlekey-221-handlekey221-handlekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-1-handleKey"  title="2.2.1 handleKey"
     target="_blank" rel="noopener"
    ></a>2.2.1 handleKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 45 è‡³ 58 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>é€šè¿‡è°ƒç”¨ SelectionKey çš„Â <code>#isAcceptable()</code>ã€<code>#isReadable()</code>ã€<code>#isWritable()</code>Â æ–¹æ³•ï¼Œ<strong>åˆ†åˆ«</strong>åˆ¤æ–­ Channel æ˜¯<strong>æ¥å—è¿æ¥</strong>å°±ç»ªï¼Œè¿˜æ˜¯<strong>è¯»</strong>å°±ç»ªï¼Œæˆ–æ˜¯<strong>å†™</strong>å°±ç»ªï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„Â <code>#handleXXXX(SelectionKey key)</code>Â æ–¹æ³•ï¼Œå¤„ç†å¯¹åº”çš„ IO äº‹ä»¶ã€‚</p>
</li>
<li>
<p>å› ä¸º SelectionKey å¯ä»¥<strong>åŒæ—¶</strong>å¯¹<strong>ä¸€ä¸ª</strong>Â Channel çš„<strong>å¤šä¸ª</strong>äº‹ä»¶æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æ­¤å¤„çš„ä»£ç éƒ½æ˜¯Â <code>if</code>Â åˆ¤æ–­ï¼Œè€Œä¸æ˜¯Â <code>if else</code>Â åˆ¤æ–­ã€‚ğŸ˜ˆ è™½ç„¶ï¼Œè€ƒè™‘åˆ°è®©ç¤ºä¾‹æ›´ç®€å•ï¼Œæœ¬æ–‡çš„å¹¶æœªç¼–å†™åŒæ—¶å¯¹ä¸€ä¸ª Channel çš„å¤šä¸ªäº‹ä»¶æ„Ÿå…´è¶£ï¼Œåç»­æˆ‘ä»¬ä¼šåœ¨ Netty çš„æºç è§£æä¸­çœ‹åˆ°ã€‚</p>
</li>
<li>
<p><code>SelectionKey.OP_CONNECT</code>Â ä½¿ç”¨åœ¨<strong>å®¢æˆ·ç«¯</strong>ä¸­ï¼Œæ‰€ä»¥æ­¤å¤„ä¸éœ€è¦åšç›¸åº”çš„åˆ¤æ–­å’Œå¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="httpsvipiocodercnnettynio-5-demo2-2-2-handleacceptablekey-222-handleacceptablekey222-handleacceptablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-2-handleAcceptableKey"  title="2.2.2 handleAcceptableKey"
     target="_blank" rel="noopener"
    ></a>2.2.2 handleAcceptableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 60 è‡³ 69 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 62 è¡Œï¼šè°ƒç”¨Â <code>ServerSocketChannel#accept()</code>Â æ–¹æ³•ï¼Œè·å¾—è¿æ¥çš„å®¢æˆ·ç«¯çš„ SocketChannel ã€‚</p>
</li>
<li>
<p>ç¬¬ 64 è¡Œï¼šé…ç½®å®¢æˆ·ç«¯çš„ SocketChannel ä¸ºéé˜»å¡ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ Selector ã€‚</p>
</li>
<li>
<p>ç¬¬ 66 è¡Œï¼šæ‰“å°æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚å®é™…åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ Logger è€Œä¸è¦ä½¿ç”¨Â <code>System.out</code>Â è¿›è¡Œè¾“å‡ºã€‚</p>
</li>
<li>
<p>ç¬¬ 68 è¡Œï¼šæ³¨å†Œå®¢æˆ·ç«¯çš„ SocketChannel åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_READ</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚è¿™æ ·å­ï¼Œåœ¨å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯( æ•°æ® )åˆ°æœåŠ¡ç«¯æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤„ç†è¯¥ IO äº‹ä»¶ã€‚</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆä¸å¯¹Â <code>SelectionKey.OP_WRITE</code>Â äº‹ä»¶æ„Ÿå…´è¶£å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥ä¸éœ€è¦å¯¹Â <code>SelectionKey.OP_WRITE</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚</p>
</li>
<li>
<p>ç»†å¿ƒçš„èƒ–å‹ä¼šå‘ç°ï¼Œ<code>Channel#register(Selector selector, int ops, Object attachment)</code>Â æ–¹æ³•çš„ç¬¬ 3 ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬æ³¨å†Œäº† SelectionKey çš„Â <code>attachment</code>Â å±æ€§ä¸ºÂ <code>new ArrayList&lt;String&gt;()</code>Â ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç»“åˆä¸‹é¢çš„Â <code>#handleReadableKey(Selection key)</code>Â æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èµ·è§£æã€‚</p>
</li>
</ul>
<h3 id="httpsvipiocodercnnettynio-5-demo2-2-3-handlereadablekey-223-handlereadablekey223-handlereadablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-3-handleReadableKey"  title="2.2.3 handleReadableKey"
     target="_blank" rel="noopener"
    ></a>2.2.3 handleReadableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 71 è‡³ 93 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 73 è¡Œï¼šè°ƒç”¨Â <code>SelectionKey#channel()</code>Â æ–¹æ³•ï¼Œè·å¾—è¯¥ SelectionKey å¯¹åº”çš„ SocketChannel ï¼Œå³å®¢æˆ·ç«¯çš„ SocketChannel ã€‚</p>
</li>
<li>
<p>ç¬¬ 75 è¡Œï¼šè°ƒç”¨Â <code>CodecUtil#read(SocketChannel channel)</code>Â æ–¹æ³•ï¼Œè¯»å–æ•°æ®ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// CodecUtil.java  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public static ByteBuffer read(SocketChannel channel) {  
</span></span><span class="line"><span class="cl"> // æ³¨æ„ï¼Œä¸è€ƒè™‘æ‹†åŒ…çš„å¤„ç†  
</span></span><span class="line"><span class="cl"> ByteBuffer buffer = ByteBuffer.allocate(1024);  
</span></span><span class="line"><span class="cl"> try {  
</span></span><span class="line"><span class="cl"> int count = channel.read(buffer);  
</span></span><span class="line"><span class="cl"> if (count == -1) {  
</span></span><span class="line"><span class="cl"> return null;  
</span></span><span class="line"><span class="cl"> }  
</span></span><span class="line"><span class="cl"> } catch (IOException e) {  
</span></span><span class="line"><span class="cl"> throw new RuntimeException(e);  
</span></span><span class="line"><span class="cl"> }  
</span></span><span class="line"><span class="cl"> return buffer;  
</span></span><span class="line"><span class="cl">}  
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>è€ƒè™‘åˆ°ç¤ºä¾‹çš„ç®€å•æ€§ï¼Œæ•°æ®çš„è¯»å–ï¼Œå°±ä¸è€ƒè™‘æ‹†åŒ…çš„å¤„ç†ã€‚ä¸ç†è§£çš„èƒ–å‹ï¼Œå¯ä»¥è‡ªå·± Google ä¸‹ã€‚</p>
</li>
<li>
<p>è°ƒç”¨Â <code>SocketChannel#read(ByteBuffer)</code>Â æ–¹æ³•ï¼Œè¯»å– Channel çš„ç¼“å†²åŒºçš„æ•°æ®åˆ° ByteBuffer ä¸­ã€‚è‹¥è¿”å›çš„ç»“æœ(Â <code>count</code>Â ) ä¸º -1 ï¼Œæ„å‘³ç€å®¢æˆ·ç«¯è¿æ¥å·²ç»æ–­å¼€ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›Â <code>null</code>Â ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿”å›Â <code>null</code>Â å‘¢ï¼Ÿä¸‹é¢ç»§ç»­è§åˆ†æ™“ã€‚</p>
</li>
<li>
<p>ç¬¬ 76 è‡³ 81 è¡Œï¼šè‹¥è¯»å–æ•°æ®è¿”å›çš„ç»“æœä¸ºÂ <code>null</code>Â æ—¶ï¼Œæ„å‘³ç€å®¢æˆ·ç«¯çš„è¿æ¥å·²ç»æ–­å¼€ï¼Œå› æ­¤å–æ¶ˆæ³¨å†ŒÂ <code>selector</code>Â å¯¹è¯¥å®¢æˆ·ç«¯çš„ SocketChannel çš„æ„Ÿå…´è¶£çš„ IO äº‹ä»¶ã€‚é€šè¿‡è°ƒç”¨æ³¨å†Œæ–¹æ³•ï¼Œå¹¶ä¸”ç¬¬ 2 ä¸ªå‚æ•°Â <code>ops</code>Â ä¸º 0 ï¼Œå¯ä»¥è¾¾åˆ°å–æ¶ˆæ³¨å†Œçš„æ•ˆæœã€‚ğŸ˜ˆ æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥å°†è¿™è¡Œä»£ç è¿›è¡Œæ³¨é‡Šï¼Œæµ‹è¯•ä¸‹æ•ˆæœå°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚</p>
</li>
<li>
<p>ç¬¬ 83 è¡Œï¼šé€šè¿‡è°ƒç”¨Â <code>ByteBuffer#position()</code>Â å¤§äº 0 ï¼Œæ¥åˆ¤æ–­<strong>å®é™…</strong>è¯»å–åˆ°æ•°æ®ã€‚</p>
</li>
<li>
<p>æ‰€ä»¥ï¼Œæ­¤å¤„ç¬”è€…åœ¨ç¤ºä¾‹ä¸­ï¼Œå¤„ç†çš„æ–¹å¼ä¸ºæ·»åŠ å“åº”æ•°æ®åˆ°Â <code>responseQueue</code>Â ä¸­ï¼Œå¹¶åœ¨ã€ç¬¬ 91 è¡Œã€‘çš„ä»£ç ä¸­ï¼Œæ³¨å†Œå®¢æˆ·ç«¯çš„ SocketChannel åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_WRITE</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚è¿™æ ·å­ï¼Œåœ¨ SocketChannelÂ <strong>å†™å°±ç»ª</strong>æ—¶ï¼Œåœ¨Â <code>#handleWritableKey(SelectionKey key)</code>Â æ–¹æ³•ä¸­ï¼Œç»Ÿä¸€å¤„ç†å†™æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p>å½“ç„¶ï¼Œè¿˜æ˜¯å› ä¸ºæ˜¯ç¤ºä¾‹ï¼Œæ‰€ä»¥è¿™æ ·çš„å®ç°æ–¹å¼ä¸æ˜¯æœ€ä¼˜ã€‚åœ¨ Netty ä¸­ï¼Œå…·ä½“çš„å®ç°æ–¹å¼æ˜¯ï¼Œå…ˆå°è¯•è°ƒç”¨Â <code>SocketChannel#write(ByteBuf)</code>Â æ–¹æ³•ï¼Œå†™æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚è‹¥å†™å…¥å¤±è´¥( æ–¹æ³•è¿”å›ç»“æœä¸º 0 )æ—¶ï¼Œå†è¿›è¡Œç±»ä¼¼ç¬”è€…çš„ä¸Šè¿°å®ç°æ–¹å¼ã€‚ç‰›é€¼ï¼Netty ï¼</p>
</li>
<li>
<p>å¦‚æœä¸å¤ªç†è§£åˆ†äº«çš„åŸå› ï¼Œå¯ä»¥å†é˜…è¯»å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ï¼š</p>
</li>
<li>
<p><a class="link" href="https://mp.weixin.qq.com/s/V4tEH1j64FHFmB8bReNI7g"  target="_blank" rel="noopener"
    >ã€Šæ·±å¤œå¯¹è¯ï¼šNIO ä¸­ SelectionKey.OP_WRITE ä½ äº†è§£å¤šå°‘ã€‹</a></p>
</li>
<li>
<p><a class="link" href="https://blog.csdn.net/a34140974/article/details/48464845"  target="_blank" rel="noopener"
    >ã€ŠJava.nio ä¸­ socketChannle.write() è¿”å› 0 çš„ç®€æ˜“è§£å†³æ–¹æ¡ˆã€‹</a></p>
</li>
<li>
<p>ğŸ˜ˆ å¦‚æœä¸ç†è§£ï¼Œæœ¨æœ‰å…³ç³»ï¼Œåœ¨Â <a class="link" href="http://svip.iocoder.cn/Dubbo/remoting-api-transport/"  target="_blank" rel="noopener"
    >ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” NIO æœåŠ¡å™¨ï¼ˆäºŒï¼‰ä¹‹ Transport å±‚ã€‹ã€Œ8. Dispacherã€</a>Â ä¸­ï¼Œæœ‰è¯¦ç»†è§£æã€‚</p>
</li>
<li>
<p>ğŸ™‚ è€ƒè™‘åˆ°ç¤ºä¾‹çš„ç®€æ´æ€§ï¼Œæ‰€ä»¥åœ¨ã€ç¬¬ 88 è‡³ 89 è¡Œã€‘çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›ï¼ˆ<code>&quot;å“åº”ï¼š&quot;</code>Â + è¯·æ±‚å†…å®¹ï¼‰ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p>æ³¨æ„ï¼Œéœ€è¦è°ƒç”¨Â <code>ByteBuffer#flip()</code>Â æ–¹æ³•ï¼Œå°† ByteBuffer ä»<strong>å†™</strong>æ¨¡å¼åˆ‡æ¢åˆ°<strong>è¯»</strong>æ¨¡å¼ã€‚</p>
</li>
<li>
<p>ç¬¬ 84 è‡³ 85 è¡Œï¼šè°ƒç”¨Â <code>CodecUtil#newString(ByteBuffer)</code>Â æ–¹æ³•ï¼Œæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿›è¡Œæ‰“å°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// CodecUtil.java  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public static String newString(ByteBuffer buffer) {  
</span></span><span class="line"><span class="cl"> buffer.flip();  
</span></span><span class="line"><span class="cl"> byte\[\] bytes = new byte\[buffer.remaining()\];  
</span></span><span class="line"><span class="cl"> System.arraycopy(buffer.array(), buffer.position(), bytes, 0, buffer.remaining());  
</span></span><span class="line"><span class="cl"> try {  
</span></span><span class="line"><span class="cl"> return new String(bytes, &#34;UTF-8&#34;);  
</span></span><span class="line"><span class="cl"> } catch (UnsupportedEncodingException e) {  
</span></span><span class="line"><span class="cl"> throw new RuntimeException(e);  
</span></span><span class="line"><span class="cl"> }  
</span></span><span class="line"><span class="cl">}  
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç¬¬ 86 è¡Œï¼šä¸€èˆ¬åœ¨æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œå¹¶è¿”å›å¤„ç†çš„ç›¸åº”ç»“æœã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ Request / Response çš„å¤„ç†ã€‚å½“ç„¶ï¼Œè€ƒè™‘åˆ°æ€§èƒ½ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å°†é€»è¾‘çš„å¤„ç†ï¼Œä¸¢åˆ°é€»è¾‘çº¿ç¨‹æ± ã€‚</p>
</li>
<li>
<p>ç¬¬ 88 è¡Œï¼šé€šè¿‡è°ƒç”¨Â <code>SelectionKey#attachment()</code>Â æ–¹æ³•ï¼Œè·å¾—æˆ‘ä»¬<strong>é™„åŠ </strong>åœ¨ SelectionKey çš„å“åº”é˜Ÿåˆ—(Â <code>responseQueue</code>Â )ã€‚å¯èƒ½æœ‰èƒ–å‹ä¼šé—®å•¦ï¼Œä¸ºä»€ä¹ˆä¸è°ƒç”¨Â <code>SocketChannel#write(ByteBuf)</code>Â æ–¹æ³•ï¼Œç›´æ¥å†™æ•°æ®ç»™å®¢æˆ·ç«¯å‘¢ï¼Ÿè™½ç„¶å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒSocketChannel éƒ½æ˜¯<strong>å¯å†™</strong>çš„ï¼Œä½†æ˜¯å¦‚æœå†™å…¥æ¯”è¾ƒé¢‘ç¹ï¼Œè¶…è¿‡ SocketChannel çš„ç¼“å­˜åŒºå¤§å°ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®â€œ<strong>ä¸¢å¤±</strong>â€ï¼Œå¹¶æœªå†™ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p>ç¬¬ 91 è¡Œï¼šæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œ<code>Channel#register(Selector selector, int ops, Object attachment)</code>Â æ–¹æ³•çš„ç¬¬ 3 ä¸ªå‚æ•°ï¼Œéœ€è¦ç»§ç»­ä¼ å…¥å“åº”é˜Ÿåˆ—(Â <code>responseQueue</code>Â )ï¼Œå› ä¸ºæ¯æ¬¡æ³¨å†Œç”Ÿæˆ<strong>æ–°</strong>çš„ SelectionKey ã€‚è‹¥ä¸ä¼ å…¥ï¼Œä¸‹é¢çš„Â <code>#handleWritableKey(SelectionKey key)</code>Â æ–¹æ³•ï¼Œä¼šè·å¾—ä¸åˆ°å“åº”é˜Ÿåˆ—(Â <code>responseQueue</code>Â )ã€‚</p>
</li>
</ul>
<h3 id="httpsvipiocodercnnettynio-5-demo2-2-4-handlewritablekey-224-handlewritablekey224-handlewritablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-2-4-handleWritableKey"  title="2.2.4 handleWritableKey"
     target="_blank" rel="noopener"
    ></a>2.2.4 handleWritableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 96 è‡³ 112 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 98 è¡Œï¼šè°ƒç”¨Â <code>SelectionKey#channel()</code>Â æ–¹æ³•ï¼Œè·å¾—è¯¥ SelectionKey å¯¹åº”çš„ SocketChannel ï¼Œå³å®¢æˆ·ç«¯çš„ SocketChannel ã€‚</p>
</li>
<li>
<p>ç¬¬ 101 è¡Œï¼šé€šè¿‡è°ƒç”¨Â <code>SelectionKey#attachment()</code>Â æ–¹æ³•ï¼Œè·å¾—æˆ‘ä»¬<strong>é™„åŠ </strong>åœ¨ SelectionKey çš„å“åº”é˜Ÿåˆ—(Â <code>responseQueue</code>Â )ã€‚</p>
</li>
<li>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œ<strong>è¿˜æ˜¯è¦æ³¨æ„</strong>ï¼Œéœ€è¦è°ƒç”¨Â <code>ByteBuffer#flip()</code>Â æ–¹æ³•ï¼Œå°† ByteBuffer ä»<strong>å†™</strong>æ¨¡å¼åˆ‡æ¢åˆ°<strong>è¯»</strong>æ¨¡å¼ã€‚</p>
</li>
<li>
<p>ç¬¬ 102 è¡Œï¼šéå†å“åº”é˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p>ç¬¬ 106 è¡Œï¼šè°ƒç”¨Â <code>CodeUtil#write(SocketChannel, content)</code>Â æ–¹æ³•ï¼Œå†™å…¥å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> // CodecUtil.java  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">public static void write(SocketChannel channel, String content) {  
</span></span><span class="line"><span class="cl"> // å†™å…¥ Buffer  
</span></span><span class="line"><span class="cl"> ByteBuffer buffer = ByteBuffer.allocate(1024);  
</span></span><span class="line"><span class="cl"> try {  
</span></span><span class="line"><span class="cl"> buffer.put(content.getBytes(&#34;UTF-8&#34;));  
</span></span><span class="line"><span class="cl"> } catch (UnsupportedEncodingException e) {  
</span></span><span class="line"><span class="cl"> throw new RuntimeException(e);  
</span></span><span class="line"><span class="cl"> }  
</span></span><span class="line"><span class="cl"> // å†™å…¥ Channel  
</span></span><span class="line"><span class="cl"> buffer.flip();  
</span></span><span class="line"><span class="cl"> try {  
</span></span><span class="line"><span class="cl"> // æ³¨æ„ï¼Œä¸è€ƒè™‘å†™å…¥è¶…è¿‡ Channel ç¼“å­˜åŒºä¸Šé™ã€‚  
</span></span><span class="line"><span class="cl"> channel.write(buffer);  
</span></span><span class="line"><span class="cl"> } catch (IOException e) {  
</span></span><span class="line"><span class="cl"> throw new RuntimeException(e);  
</span></span><span class="line"><span class="cl"> }  
</span></span><span class="line"><span class="cl">}  
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ç¬¬ 111 è¡Œï¼š<strong>æ³¨æ„</strong>ï¼Œå†ç»“æŸå†™å…¥åï¼Œéœ€è¦<strong>é‡æ–°</strong>æ³¨å†Œå®¢æˆ·ç«¯çš„ SocketChannel åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_READ</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒSocketChannelÂ <strong>éƒ½æ˜¯å†™å°±ç»ªçš„</strong>ï¼Œå¦‚æœä¸å–æ¶ˆæ‰æ³¨å†Œæ‰å¯¹Â <code>SelectionKey.OP_READ</code>Â äº‹ä»¶æ„Ÿå…´è¶£ï¼Œå°±ä¼šå¯¼è‡´åå¤è§¦å‘æ— ç”¨çš„å†™äº‹ä»¶å¤„ç†ã€‚ğŸ˜ˆ æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥å°†è¿™è¡Œä»£ç è¿›è¡Œæ³¨é‡Šï¼Œæµ‹è¯•ä¸‹æ•ˆæœå°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚</p>
</li>
</ul>
<h2 id="httpsvipiocodercnnettynio-5-demo2-3-main-23-main23-main"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#2-3-main"  title="2.3 main"
     target="_blank" rel="noopener"
    ></a>2.3 main</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 114 è‡³ 116 è¡Œã€‘</p>
</blockquote>
<ul>
<li>æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª NioServer å¯¹è±¡ã€‚</li>
</ul>
<p>æ’¸åˆ°æ­¤å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡Â <code>telnet 127.0.0.1 8080</code>Â çš„æ–¹å¼ï¼Œè¿æ¥æœåŠ¡ç«¯ï¼Œè¿›è¡Œè¯»å†™æ•°æ®çš„æµ‹è¯•ã€‚</p>
<h1 id="httpsvipiocodercnnettynio-5-demo3-e5aea2e688b7e7abaf-3-å®¢æˆ·ç«¯3-å®¢æˆ·ç«¯"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-%E5%AE%A2%E6%88%B7%E7%AB%AF"  title="3. å®¢æˆ·ç«¯"
     target="_blank" rel="noopener"
    ></a>3. å®¢æˆ·ç«¯</h1>
<p>å®¢æˆ·ç«¯çš„å®ç°ä»£ç ï¼Œç»å¤§æ•°å’ŒæœåŠ¡ç«¯ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†æçš„ç›¸å¯¹ä¼šç®€ç•¥ä¸€äº›ã€‚ä¸ç„¶ï¼Œè‡ªå·±éƒ½å«Œå¼ƒè‡ªå·±å¤ªå•°å—¦äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> 1: public class NioClient {  
</span></span><span class="line"><span class="cl"> 2:   
</span></span><span class="line"><span class="cl"> 3: Â  Â  private SocketChannel clientSocketChannel;  
</span></span><span class="line"><span class="cl"> 4: Â  Â  private Selector selector;  
</span></span><span class="line"><span class="cl"> 5: Â  Â  private final List&lt;String&gt; responseQueue = new ArrayList&lt;String&gt;();  
</span></span><span class="line"><span class="cl"> 6:   
</span></span><span class="line"><span class="cl"> 7: Â  Â  private CountDownLatch connected = new CountDownLatch(1);  
</span></span><span class="line"><span class="cl"> 8:   
</span></span><span class="line"><span class="cl"> 9: Â  Â  public NioClient() throws IOException, InterruptedException {  
</span></span><span class="line"><span class="cl"> 10: Â  Â  Â  Â  // æ‰“å¼€ Client Socket Channel  
</span></span><span class="line"><span class="cl"> 11: Â  Â  Â  Â  clientSocketChannel = SocketChannel.open();  
</span></span><span class="line"><span class="cl"> 12: Â  Â  Â  Â  // é…ç½®ä¸ºéé˜»å¡  
</span></span><span class="line"><span class="cl"> 13: Â  Â  Â  Â  clientSocketChannel.configureBlocking(false);  
</span></span><span class="line"><span class="cl"> 14: Â  Â  Â  Â  // åˆ›å»º Selector  
</span></span><span class="line"><span class="cl"> 15: Â  Â  Â  Â  selector = Selector.open();  
</span></span><span class="line"><span class="cl"> 16: Â  Â  Â  Â  // æ³¨å†Œ Server Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl"> 17: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_CONNECT);  
</span></span><span class="line"><span class="cl"> 18: Â  Â  Â  Â  // è¿æ¥æœåŠ¡å™¨  
</span></span><span class="line"><span class="cl"> 19: Â  Â  Â  Â  clientSocketChannel.connect(new InetSocketAddress(8080));  
</span></span><span class="line"><span class="cl"> 20:   
</span></span><span class="line"><span class="cl"> 21: Â  Â  Â  Â  new Thread(new Runnable() {  
</span></span><span class="line"><span class="cl"> 22: Â  Â  Â  Â  Â  Â  @Override  
</span></span><span class="line"><span class="cl"> 23: Â  Â  Â  Â  Â  Â  public void run() {  
</span></span><span class="line"><span class="cl"> 24: Â  Â  Â  Â  Â  Â  Â  Â  try {  
</span></span><span class="line"><span class="cl"> 25: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleKeys();  
</span></span><span class="line"><span class="cl"> 26: Â  Â  Â  Â  Â  Â  Â  Â  } catch (IOException e) {  
</span></span><span class="line"><span class="cl"> 27: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.printStackTrace();  
</span></span><span class="line"><span class="cl"> 28: Â  Â  Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 29: Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 30: Â  Â  Â  Â  }).start();  
</span></span><span class="line"><span class="cl"> 31:   
</span></span><span class="line"><span class="cl"> 32: Â  Â  Â  Â  if (connected.getCount() != 0) {  
</span></span><span class="line"><span class="cl"> 33: Â  Â  Â  Â  Â  Â  connected.await();  
</span></span><span class="line"><span class="cl"> 34: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 35: Â  Â  Â  Â  System.out.println(&#34;Client å¯åŠ¨å®Œæˆ&#34;);  
</span></span><span class="line"><span class="cl"> 36: Â  Â  }  
</span></span><span class="line"><span class="cl"> 37:   
</span></span><span class="line"><span class="cl"> 38: Â  Â  @SuppressWarnings(&#34;Duplicates&#34;)  
</span></span><span class="line"><span class="cl"> 39: Â  Â  private void handleKeys() throws IOException {  
</span></span><span class="line"><span class="cl"> 40: Â  Â  Â  Â  while (true) {  
</span></span><span class="line"><span class="cl"> 41: Â  Â  Â  Â  Â  Â  // é€šè¿‡ Selector é€‰æ‹© Channel  
</span></span><span class="line"><span class="cl"> 42: Â  Â  Â  Â  Â  Â  int selectNums = selector.select(30 \* 1000L);  
</span></span><span class="line"><span class="cl"> 43: Â  Â  Â  Â  Â  Â  if (selectNums == 0) {  
</span></span><span class="line"><span class="cl"> 44: Â  Â  Â  Â  Â  Â  Â  Â  continue;  
</span></span><span class="line"><span class="cl"> 45: Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 46:   
</span></span><span class="line"><span class="cl"> 47: Â  Â  Â  Â  Â  Â  // éå†å¯é€‰æ‹©çš„ Channel çš„ SelectionKey é›†åˆ  
</span></span><span class="line"><span class="cl"> 48: Â  Â  Â  Â  Â  Â  Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();  
</span></span><span class="line"><span class="cl"> 49: Â  Â  Â  Â  Â  Â  while (iterator.hasNext()) {  
</span></span><span class="line"><span class="cl"> 50: Â  Â  Â  Â  Â  Â  Â  Â  SelectionKey key = iterator.next();  
</span></span><span class="line"><span class="cl"> 51: Â  Â  Â  Â  Â  Â  Â  Â  iterator.remove(); // ç§»é™¤ä¸‹é¢è¦å¤„ç†çš„ SelectionKey  
</span></span><span class="line"><span class="cl"> 52: Â  Â  Â  Â  Â  Â  Â  Â  if (!key.isValid()) { // å¿½ç•¥æ— æ•ˆçš„ SelectionKey  
</span></span><span class="line"><span class="cl"> 53: Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continue;  
</span></span><span class="line"><span class="cl"> 54: Â  Â  Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 55:   
</span></span><span class="line"><span class="cl"> 56: Â  Â  Â  Â  Â  Â  Â  Â  handleKey(key);  
</span></span><span class="line"><span class="cl"> 57: Â  Â  Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 58: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 59: Â  Â  }  
</span></span><span class="line"><span class="cl"> 60:   
</span></span><span class="line"><span class="cl"> 61: Â  Â  private synchronized void handleKey(SelectionKey key) throws IOException {  
</span></span><span class="line"><span class="cl"> 62: Â  Â  Â  Â  // æ¥å—è¿æ¥å°±ç»ª  
</span></span><span class="line"><span class="cl"> 63: Â  Â  Â  Â  if (key.isConnectable()) {  
</span></span><span class="line"><span class="cl"> 64: Â  Â  Â  Â  Â  Â  handleConnectableKey(key);  
</span></span><span class="line"><span class="cl"> 65: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 66: Â  Â  Â  Â  // è¯»å°±ç»ª  
</span></span><span class="line"><span class="cl"> 67: Â  Â  Â  Â  if (key.isReadable()) {  
</span></span><span class="line"><span class="cl"> 68: Â  Â  Â  Â  Â  Â  handleReadableKey(key);  
</span></span><span class="line"><span class="cl"> 69: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 70: Â  Â  Â  Â  // å†™å°±ç»ª  
</span></span><span class="line"><span class="cl"> 71: Â  Â  Â  Â  if (key.isWritable()) {  
</span></span><span class="line"><span class="cl"> 72: Â  Â  Â  Â  Â  Â  handleWritableKey(key);  
</span></span><span class="line"><span class="cl"> 73: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 74: Â  Â  }  
</span></span><span class="line"><span class="cl"> 75:   
</span></span><span class="line"><span class="cl"> 76: Â  Â  private void handleConnectableKey(SelectionKey key) throws IOException {  
</span></span><span class="line"><span class="cl"> 77: Â  Â  Â  Â  // å®Œæˆè¿æ¥  
</span></span><span class="line"><span class="cl"> 78: Â  Â  Â  Â  if (!clientSocketChannel.isConnectionPending()) {  
</span></span><span class="line"><span class="cl"> 79: Â  Â  Â  Â  Â  Â  return;  
</span></span><span class="line"><span class="cl"> 80: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl"> 81: Â  Â  Â  Â  clientSocketChannel.finishConnect();  
</span></span><span class="line"><span class="cl"> 82: Â  Â  Â  Â  // log  
</span></span><span class="line"><span class="cl"> 83: Â  Â  Â  Â  System.out.println(&#34;æ¥å—æ–°çš„ Channel&#34;);  
</span></span><span class="line"><span class="cl"> 84: Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl"> 85: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_READ, responseQueue);  
</span></span><span class="line"><span class="cl"> 86: Â  Â  Â  Â  // æ ‡è®°ä¸ºå·²è¿æ¥  
</span></span><span class="line"><span class="cl"> 87: Â  Â  Â  Â  connected.countDown();  
</span></span><span class="line"><span class="cl"> 88: Â  Â  }  
</span></span><span class="line"><span class="cl"> 89:   
</span></span><span class="line"><span class="cl"> 90: Â  Â  @SuppressWarnings(&#34;Duplicates&#34;)  
</span></span><span class="line"><span class="cl"> 91: Â  Â  private void handleReadableKey(SelectionKey key) throws ClosedChannelException {  
</span></span><span class="line"><span class="cl"> 92: Â  Â  Â  Â  // Client Socket Channel  
</span></span><span class="line"><span class="cl"> 93: Â  Â  Â  Â  SocketChannel clientSocketChannel = (SocketChannel) key.channel();  
</span></span><span class="line"><span class="cl"> 94: Â  Â  Â  Â  // è¯»å–æ•°æ®  
</span></span><span class="line"><span class="cl"> 95: Â  Â  Â  Â  ByteBuffer readBuffer = CodecUtil.read(clientSocketChannel);  
</span></span><span class="line"><span class="cl"> 96: Â  Â  Â  Â  // æ‰“å°æ•°æ®  
</span></span><span class="line"><span class="cl"> 97: Â  Â  Â  Â  if (readBuffer.position() &gt; 0) { // å†™å…¥æ¨¡å¼ä¸‹ï¼Œ  
</span></span><span class="line"><span class="cl"> 98: Â  Â  Â  Â  Â  Â  String content = CodecUtil.newString(readBuffer);  
</span></span><span class="line"><span class="cl"> 99: Â  Â  Â  Â  Â  Â  System.out.println(&#34;è¯»å–æ•°æ®ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl">100: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl">101: Â  Â  }  
</span></span><span class="line"><span class="cl">102:   
</span></span><span class="line"><span class="cl">103: Â  Â  @SuppressWarnings(&#34;Duplicates&#34;)  
</span></span><span class="line"><span class="cl">104: Â  Â  private void handleWritableKey(SelectionKey key) throws ClosedChannelException {  
</span></span><span class="line"><span class="cl">105: Â  Â  Â  Â  // Client Socket Channel  
</span></span><span class="line"><span class="cl">106: Â  Â  Â  Â  SocketChannel clientSocketChannel = (SocketChannel) key.channel();  
</span></span><span class="line"><span class="cl">107:   
</span></span><span class="line"><span class="cl">108: Â  Â  Â  Â  // éå†å“åº”é˜Ÿåˆ—  
</span></span><span class="line"><span class="cl">109: Â  Â  Â  Â  List&lt;String&gt; responseQueue = (ArrayList&lt;String&gt;) key.attachment();  
</span></span><span class="line"><span class="cl">110: Â  Â  Â  Â  for (String content : responseQueue) {  
</span></span><span class="line"><span class="cl">111: Â  Â  Â  Â  Â  Â  // æ‰“å°æ•°æ®  
</span></span><span class="line"><span class="cl">112: Â  Â  Â  Â  Â  Â  System.out.println(&#34;å†™å…¥æ•°æ®ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl">113: Â  Â  Â  Â  Â  Â  // è¿”å›  
</span></span><span class="line"><span class="cl">114: Â  Â  Â  Â  Â  Â  CodecUtil.write(clientSocketChannel, content);  
</span></span><span class="line"><span class="cl">115: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl">116: Â  Â  Â  Â  responseQueue.clear();  
</span></span><span class="line"><span class="cl">117:   
</span></span><span class="line"><span class="cl">118: Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl">119: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_READ, responseQueue);  
</span></span><span class="line"><span class="cl">120: Â  Â  }  
</span></span><span class="line"><span class="cl">121:   
</span></span><span class="line"><span class="cl">122: Â  Â  public synchronized void send(String content) throws ClosedChannelException {  
</span></span><span class="line"><span class="cl">123: Â  Â  Â  Â  // æ·»åŠ åˆ°å“åº”é˜Ÿåˆ—  
</span></span><span class="line"><span class="cl">124: Â  Â  Â  Â  responseQueue.add(content);  
</span></span><span class="line"><span class="cl">125: Â  Â  Â  Â  // æ‰“å°æ•°æ®  
</span></span><span class="line"><span class="cl">126: Â  Â  Â  Â  System.out.println(&#34;å†™å…¥æ•°æ®ï¼š&#34; \+ content);  
</span></span><span class="line"><span class="cl">127: Â  Â  Â  Â  // æ³¨å†Œ Client Socket Channel åˆ° Selector  
</span></span><span class="line"><span class="cl">128: Â  Â  Â  Â  clientSocketChannel.register(selector, SelectionKey.OP_WRITE, responseQueue);  
</span></span><span class="line"><span class="cl">129: Â  Â  Â  Â  selector.wakeup();  
</span></span><span class="line"><span class="cl">130: Â  Â  }  
</span></span><span class="line"><span class="cl">131:   
</span></span><span class="line"><span class="cl">132: Â  Â  public static void main(String\[\] args) throws IOException, InterruptedException {  
</span></span><span class="line"><span class="cl">133: Â  Â  Â  Â  NioClient client = new NioClient();  
</span></span><span class="line"><span class="cl">134: Â  Â  Â  Â  for (int i = 0; i &lt; 30; i++) {  
</span></span><span class="line"><span class="cl">135: Â  Â  Â  Â  Â  Â  client.send(&#34;nihao: &#34; \+ i);  
</span></span><span class="line"><span class="cl">136: Â  Â  Â  Â  Â  Â  Thread.sleep(1000L);  
</span></span><span class="line"><span class="cl">137: Â  Â  Â  Â  }  
</span></span><span class="line"><span class="cl">138: Â  Â  }  
</span></span><span class="line"><span class="cl">139:   
</span></span><span class="line"><span class="cl">140: }  
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•´å—ä»£ç æˆ‘ä»¬å¯ä»¥åˆ†æˆ 3 éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>æ„é€ æ–¹æ³•ï¼šåˆå§‹åŒ– NIO å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p><code>#handleKeys()</code>Â æ–¹æ³•ï¼šåŸºäº Selector å¤„ç† IO æ“ä½œã€‚</p>
</li>
<li>
<p><code>#main(String[] args)</code>Â æ–¹æ³•ï¼šåˆ›å»º NIO å®¢æˆ·ç«¯ï¼Œå¹¶å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®ã€‚</p>
</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€å°èŠ‚æ¥åˆ†äº«ã€‚</p>
<h2 id="httpsvipiocodercnnettynio-5-demo3-1-e69e84e980a0e696b9e6b395-31-æ„é€ æ–¹æ³•31-æ„é€ æ–¹æ³•"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-1-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"  title="3.1 æ„é€ æ–¹æ³•"
     target="_blank" rel="noopener"
    ></a>3.1 æ„é€ æ–¹æ³•</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 3 è‡³ 36 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p><code>clientSocketChannel</code>Â å±æ€§ï¼Œå®¢æˆ·ç«¯çš„ SocketChannel ï¼Œåœ¨ã€ç¬¬ 9 è‡³ 13 è¡Œã€‘å’Œã€ç¬¬ 19 è¡Œã€‘çš„ä»£ç è¿›è¡Œåˆå§‹åŒ–ï¼Œé‡ç‚¹æ˜¯æ­¤å¤„è¿æ¥äº†æŒ‡å®šæœåŠ¡ç«¯ã€‚</p>
</li>
<li>
<p><code>selector</code>Â å±æ€§ï¼Œé€‰æ‹©å™¨ï¼Œåœ¨ã€ç¬¬ 14 è‡³ 17 è¡Œã€‘çš„ä»£ç è¿›è¡Œåˆå§‹åŒ–ï¼Œé‡ç‚¹æ˜¯æ­¤å¤„å°†Â <code>clientSocketChannel</code>Â åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_CONNECT</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚è¿™æ ·å­ï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯<strong>æˆåŠŸ</strong>æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤„ç†è¯¥ IO äº‹ä»¶ã€‚</p>
</li>
<li>
<p><code>responseQueue</code>Â å±æ€§ï¼Œç›´æ¥å£°æ˜ä¸º NioClient çš„æˆå‘˜å˜é‡ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿Â <code>#send(String content)</code>Â æ–¹æ³•çš„å®ç°ã€‚</p>
</li>
<li>
<p>ç¬¬ 21 è‡³ 30 è¡Œï¼šè°ƒç”¨Â <code>#handleKeys()</code>Â æ–¹æ³•ï¼ŒåŸºäº Selector å¤„ç† IO äº‹ä»¶ã€‚æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œæˆ‘ä»¬æ˜¯å¯åŠ¨äº†ä¸€ä¸ª<strong>çº¿ç¨‹</strong>è¿›è¡Œå¤„ç†ã€‚å› ä¸ºåœ¨åç»­çš„Â <code>#main()</code>Â æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å‘é€è¯·æ±‚æ•°æ®çš„æ–¹æ³•ï¼Œä¸èƒ½ç›´æ¥åœ¨<strong>ä¸»çº¿ç¨‹</strong>ï¼Œè½®è¯¢å¤„ç† IO äº‹ä»¶ã€‚ğŸ˜ˆ æœºæ™ºçš„èƒ–å‹ï¼Œå¯èƒ½å·²ç»å‘ç°ï¼ŒNioServer ä¸¥æ ¼æ¥è¯´ï¼Œä¹Ÿæ˜¯åº”è¯¥è¿™æ ·å¤„ç†ã€‚</p>
</li>
<li>
<p>ç¬¬ 32 è‡³ 34 è¡Œï¼šé€šè¿‡ CountDownLatch æ¥å®ç°é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯æˆåŠŸè¿æ¥ä¸ŠæœåŠ¡ç«¯ã€‚å…·ä½“çš„Â <code>CountDownLatch#countDown()</code>Â æ–¹æ³•ï¼Œåœ¨Â <code>#handleConnectableKey(SelectionKey key)</code>Â æ–¹æ³•ä¸­è°ƒç”¨ã€‚å½“ç„¶ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨ CountDownLatch æ¥å®ç°é˜»å¡ç­‰å¾…ï¼Œè¿˜å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼:</p>
</li>
<li>
<p>Object çš„ wait å’Œ notify çš„æ–¹å¼ã€‚</p>
</li>
<li>
<p>Lock çš„ await å’Œ notify çš„æ–¹å¼ã€‚</p>
</li>
<li>
<p>Queue çš„é˜»å¡ç­‰å¾…æ–¹å¼ã€‚</p>
</li>
<li>
<p>ğŸ˜ˆ å¼€å¿ƒå°±å¥½ï¼Œçš®ä¸€ä¸‹å¾ˆå¼€å¿ƒã€‚</p>
</li>
</ul>
<h2 id="httpsvipiocodercnnettynio-5-demo3-2-handlekeys-32-handlekeys32-handlekeys"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-2-handleKeys"  title="3.2 handleKeys"
     target="_blank" rel="noopener"
    ></a>3.2 handleKeys</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 38 è‡³ 59 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<p><strong>å®Œå…¨</strong>å’Œ NioServer ä¸­çš„è¯¥æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ï¼Œçœç•¥ã€‚</p>
<h3 id="httpsvipiocodercnnettynio-5-demo3-2-1-handlekey-321-handlekey321-handlekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-2-1-handleKey"  title="3.2.1 handleKey"
     target="_blank" rel="noopener"
    ></a>3.2.1 handleKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 61 è‡³ 74 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<p><strong>å¤§ä½“</strong>é€»è¾‘å’Œ NioServer ä¸­çš„è¯¥æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ï¼Œå·®åˆ«å°†å¯¹Â <code>SelectionKey.OP_WRITE</code>Â äº‹ä»¶çš„å¤„ç†æ”¹æˆå¯¹Â <code>SelectionKey.OP_CONNECT</code>Â äº‹ä»¶çš„å¤„ç†ã€‚</p>
<h3 id="httpsvipiocodercnnettynio-5-demo3-3-2-handleconnectablekey-332-handleconnectablekey332-handleconnectablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-2-handleConnectableKey"  title="3.3.2 handleConnectableKey"
     target="_blank" rel="noopener"
    ></a>3.3.2 handleConnectableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 76 è‡³ 88 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 77 è‡³ 81 è¡Œï¼šåˆ¤æ–­å®¢æˆ·ç«¯çš„ SocketChannel ä¸Šæ˜¯å¦<strong>æ­£åœ¨è¿›è¡Œè¿æ¥</strong>çš„æ“ä½œï¼Œè‹¥æ˜¯ï¼Œåˆ™å®Œæˆè¿æ¥ã€‚</p>
</li>
<li>
<p>ç¬¬ 83 è¡Œï¼šæ‰“å°æ—¥å¿—ã€‚</p>
</li>
<li>
<p>ç¬¬ 85 è¡Œï¼šæ³¨å†Œå®¢æˆ·ç«¯çš„ SocketChannel åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_READ</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚è¿™æ ·å­ï¼Œåœ¨å®¢æˆ·ç«¯æ¥æ”¶åˆ°åˆ°æœåŠ¡ç«¯çš„æ¶ˆæ¯( æ•°æ® )æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤„ç†è¯¥ IO äº‹ä»¶ã€‚</p>
</li>
<li>
<p>ç¬¬ 87 è¡Œï¼šè°ƒç”¨Â <code>CountDownLatch#countDown()</code>Â æ–¹æ³•ï¼Œç»“æŸ NioClient æ„é€ æ–¹æ³•ä¸­çš„ã€ç¬¬ 32 è‡³ 34 è¡Œã€‘çš„é˜»å¡ç­‰å¾…è¿æ¥å®Œæˆã€‚</p>
</li>
</ul>
<h3 id="httpsvipiocodercnnettynio-5-demo3-3-3-handlereadablekey-333-handlereadablekey333-handlereadablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-3-handleReadableKey"  title="3.3.3 handleReadableKey"
     target="_blank" rel="noopener"
    ></a>3.3.3 handleReadableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 91 è‡³ 101 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<p><strong>å¤§ä½“</strong>é€»è¾‘å’Œ NioServer ä¸­çš„è¯¥æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ï¼Œ<strong>å»æ‰å“åº”è¯·æ±‚çš„ç›¸å…³é€»è¾‘</strong>ã€‚ğŸ˜ˆ å¦‚æœä¸å»æ‰ï¼Œå°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº’å‘æ¶ˆæ¯çš„â€œæ­»å¾ªç¯â€äº†ã€‚</p>
<h3 id="httpsvipiocodercnnettynio-5-demo3-3-4-handlewritablekey-334-handlewritablekey334-handlewritablekey"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-4-handleWritableKey"  title="3.3.4 handleWritableKey"
     target="_blank" rel="noopener"
    ></a>3.3.4 handleWritableKey</h3>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 103 è‡³ 120 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<p><strong>å®Œå…¨</strong>å’Œ NioServer ä¸­çš„è¯¥æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<h2 id="httpsvipiocodercnnettynio-5-demo3-3-send-33-send33-send"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-3-send"  title="3.3 send"
     target="_blank" rel="noopener"
    ></a>3.3 send</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 122 è‡³ 130 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<p>å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ¶ˆæ¯ç»™æœåŠ¡ç«¯ã€‚</p>
<ul>
<li>
<p>ç¬¬ 124 è¡Œï¼šæ·»åŠ åˆ°å“åº”é˜Ÿåˆ—(Â <code>responseQueue</code>Â ) ä¸­ã€‚</p>
</li>
<li>
<p>ç¬¬ 126 è¡Œï¼šæ‰“å°æ—¥å¿—ã€‚</p>
</li>
<li>
<p>ç¬¬ 128 è¡Œï¼šæ³¨å†Œå®¢æˆ·ç«¯çš„ SocketChannel åˆ°Â <code>selector</code>Â ä¸­ï¼Œå¹¶å¯¹Â <code>SelectionKey.OP_WRITE</code>Â äº‹ä»¶æ„Ÿå…´è¶£ã€‚å…·ä½“çš„åŸå› ï¼Œå’Œ NioServer çš„Â <code>#handleReadableKey(SelectionKey key)</code>Â æ–¹æ³•çš„ã€ç¬¬ 88 è¡Œã€‘ä¸€æ ·ã€‚</p>
</li>
<li>
<p>ç¬¬ 129 è¡Œï¼šè°ƒç”¨Â <code>Selector#wakeup()</code>Â æ–¹æ³•ï¼Œå”¤é†’Â <code>#handleKeys()</code>Â æ–¹æ³•ä¸­ï¼Œ<code>Selector#select(long timeout)</code>Â æ–¹æ³•çš„é˜»å¡ç­‰å¾…ã€‚</p>
</li>
<li>
<p>å› ä¸ºï¼Œåœ¨Â <code>Selector#select(long timeout)</code>Â æ–¹æ³•çš„å®ç°ä¸­ï¼Œæ˜¯ä»¥è°ƒç”¨<strong>å½“æ—¶</strong>ï¼Œå¯¹ SocketChannel çš„æ„Ÿå…´è¶£çš„äº‹ä»¶ ã€‚</p>
</li>
<li>
<p>æ‰€ä»¥ï¼Œåœ¨ã€ç¬¬ 128 è¡Œã€‘çš„ä»£ç ä¸­ï¼Œå³ä½¿ä¿®æ”¹äº†å¯¹ SocketChannel çš„æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œä¹Ÿä¸ä¼šç»“æŸÂ <code>Selector#select(long timeout)</code>Â æ–¹æ³•çš„é˜»å¡ç­‰å¾…ã€‚å› æ­¤ï¼Œéœ€è¦è¿›è¡Œå”¤é†’æ“ä½œã€‚</p>
</li>
<li>
<p>ğŸ˜ˆ æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥å°†è¿™è¡Œä»£ç è¿›è¡Œæ³¨é‡Šï¼Œæµ‹è¯•ä¸‹æ•ˆæœå°±å¾ˆå®¹æ˜“æ˜ç™½äº†ã€‚</p>
</li>
</ul>
<h2 id="httpsvipiocodercnnettynio-5-demo3-4-main-34-main34-main"><a class="link" href="http://svip.iocoder.cn/Netty/nio-5-demo/#3-4-main"  title="3.4 main"
     target="_blank" rel="noopener"
    ></a>3.4 main</h2>
<blockquote>
<p>å¯¹åº”ã€ç¬¬ 132 è‡³ 137 è¡Œã€‘çš„ä»£ç ã€‚</p>
</blockquote>
<ul>
<li>
<p>ç¬¬ 133 è¡Œï¼šåˆ›å»ºä¸€ä¸ª NioClient å¯¹è±¡ã€‚</p>
</li>
<li>
<p>ç¬¬ 134 è‡³ 137 è¡Œï¼šæ¯ç§’å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚è€ƒè™‘åˆ°ä»£ç æ²¡æœ‰å¤„ç†æ‹†åŒ…çš„é€»è¾‘ï¼Œæ‰€ä»¥å¢åŠ äº†é—´éš” 1 ç§’çš„ sleep ã€‚</p>
</li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B8%80/">
        
        

        <div class="article-details">
            <h2 class="article-title">nettyæºç åˆ†æä¸€</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B8%89/">
        
        

        <div class="article-details">
            <h2 class="article-title">nettyæºç åˆ†æä¸‰</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%BA%8C/">
        
        

        <div class="article-details">
            <h2 class="article-title">nettyæºç åˆ†æäºŒ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/myblog/p/netty%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%9B%9B/">
        
        

        <div class="article-details">
            <h2 class="article-title">nettyæºç åˆ†æå››</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/myblog/p/netty%E9%9D%A2%E8%AF%95%E9%A2%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">nettyé¢è¯•é¢˜</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/npm/sticker-heo@2022.7.5/Sticker-100/"],"locale":{"admin":"ğŸ‘»å±‘åšä¸»","placeholder":"ğŸ‰ç•™ä¸‹ä½ çš„è„šå°."},"requiredMeta":["name","email"]});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2023 TauZZ&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/myblog/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
